




# How it works

##

<br/>

* ## Working
  
  <br/>
  
  * Storage plugin instance will be registered as a service inside your **backend-engine**.
  
  <br/>
  
  * Storage plugin instance will be running with a **Dapr Sidecar** which
  is managed by your **Backend-Engine** plugin.
  
  
  <br/>
  
  
  
  * Your storage plugin instance is written in **Express App** which is connected
  with your **Glue Plugin Graphql** and **Glue Plugin Backend-Engine** and it is 
  already configured with **Glue Plugin Minio** in order to store the files which is
  running behind the scene.
  
  
  <br/>
  
  * Behind the scene what is happening is, there is an **Express.js** application
  inside which it is connected with **minio** and **graphql**. There are routes present
  already for uploading the file and getting the details of already uploaded file.
  
  <br/>
  
  * If the storage plugin is installed correctly, then you will get a folder named storage
  inside your functions folder, where your whole logic of file upload and saving its information
  to graphql is written.

  <br/>
  
  * Your directory stucture for the **storage plugin instance** should be something
    like this:
    <br/>

    ```jsx
      ðŸ“¦storage
        â”£ ðŸ“‚dist
        â”£ ðŸ“‚node_modules
        â”£ ðŸ“‚src
        â”ƒ â”£ ðŸ“‚controllers
        â”ƒ â”ƒ â”£ ðŸ“‚storage
        â”ƒ â”ƒ â”ƒ â”£ ðŸ“‚graphql
        â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œmutations.ts
        â”ƒ â”ƒ â”ƒ â”ƒ â”— ðŸ“œqueries.ts
        â”ƒ â”ƒ â”ƒ â”£ ðŸ“‚handlers
        â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œfile.ts
        â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œget.ts
        â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œindex.ts
        â”ƒ â”ƒ â”ƒ â”ƒ â”— ðŸ“œupload.ts
        â”ƒ â”ƒ â”ƒ â”— ðŸ“œhelpers.ts
        â”ƒ â”ƒ â”— ðŸ“œcommons.ts
        â”ƒ â”£ ðŸ“‚middlewares
        â”ƒ â”ƒ â”— ðŸ“œ.gitkeep
        â”ƒ â”£ ðŸ“‚providers
        â”ƒ â”ƒ â”£ ðŸ“œexpress.ts
        â”ƒ â”ƒ â”£ ðŸ“œlocals.ts
        â”ƒ â”ƒ â”— ðŸ“œroutes.ts
        â”ƒ â”£ ðŸ“‚routes
        â”ƒ â”ƒ â”£ ðŸ“œ.gitkeep
        â”ƒ â”ƒ â”— ðŸ“œstorage.ts
        â”ƒ â”— ðŸ“œindex.ts
        â”£ ðŸ“œ.env
        â”£ ðŸ“œDockerfile
        â”£ ðŸ“œREADME.md
        â”£ ðŸ“œpackage.json
        â”£ ðŸ“œrouter.js
        â”— ðŸ“œtsconfig.json
    ```
  <br/>
  <br/>
  
  * In order to interact with this plugin there is a file named **router.js**
    present in root directory of the instance. If you open that **router.js** 
    file, you will see a string value attached to a key named **path**, this
    is the string which we need to append after your nginx url(http://localhost:9090).
  
    In my case my path value will be something like this:
    
    ```jsx
        module.exports = () => [
        {
          "path": "/backend/storage/upload/(.*)",
          "size_in_mb": 100,
          "proxy": {
            "instance": "storage:3500",
            "path": "/v1.0/invoke/storage/method/upload/$1",
          },
        },
       ];
    ```
    
    <br/>
  
    So in order to access my **storage plugin instance** its base url should be
    something like this,
    
    
    **http://localhost:9090/backend/storage/upload/**
  
  <br/>
  <br/>
  
  * In order to start this plugin you need to run the following command:
    
    <br/>
  
    ```bash
    $ node glue develop:up
    ```
  
    <br/>

    This command will start running the docker image of all the instances
    and plugin you have created. Here, in this case it will start running
    your **storage plugin instance image**, inside your **backend-engine** container.
  
  <br/>

* ## Instructions to start development of with this plugin
  
  <br/>
  
  * Inside your **storage instance directory** you will see that there is
  directory named **src** inside which there is an **express** app wirtten in 
  **typescript**. You can go ahead and start your development from there.













